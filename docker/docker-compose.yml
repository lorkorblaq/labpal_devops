version: '3.8'
services:
  labpal_main:
    image: lorkorblaq/labpal_main:latest
    ports:
      - "8080:8080"
    networks:
      - labpal_network
    restart: always
    depends_on:
      - labpal_nginx
      - labpal_api
      - labpal_redis  
  
  labpal_api:
    image: lorkorblaq/labpal_api:latest
    ports:
      - "3000:3000"
    networks:
      - labpal_network
    restart: always

  labpal_gpt:
    image: lorkorblaq/labpal_gpt:latest
    ports:
      - "3500:3500"
    networks:
      - labpal_network
    restart: always
    deploy:
      resources:
        limits:
          memory: 2g
          cpus: "1.0"

  labpal_nginx:
    image: lorkorblaq/labpal_nginx:secure
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /etc/letsencrypt:/etc/letsencrypt
      # - /clinicalx_nginx.conf:/etc/nginx/nginx.conf.d
    networks:
      - labpal_network
    restart: always

  labpal_redis:
    image: lorkorblaq/labpal_redis:latest
    ports:
      - "6379:6379"
    networks:
      - labpal_network
    restart: always
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
networks:
  labpal_network:
    driver: bridge





# docker run --name redis-server -d -p 6379:6379 redis:7-bookworm

# docker pull redis:7-bookworm

# v redis.conf:/usr/local/etc/redis/redis.conf redis:7-bookworm redis-server /usr/local/etc/redis/redis.conf